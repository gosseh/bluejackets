<!DOCTYPE html>
<html>
  <head>
    <title>Marker Animations</title>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>
    <script
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCTujvwHxlUQq3MoQlAZJ1ps76sQSdCtI0&callback=initMap&libraries=&v=weekly"
      defer
    ></script>
    <style type="text/css">
      /* Set the size of the div element that contains the map */
      #map {
        height: 400px;
        /* The height is 400 pixels */
        width: 100%;
        /* The width is the width of the web page */
      }
    </style>
    <script>
	  let latitude = 42.280;
	  let longitude = -83.750;
	  if (typeof(Storage) !== "undefined") {
		if (localStorage.latitude && localStorage.longitude) {
	      latitude = parseFloat(localStorage.latitude);
		  longitude = parseFloat(localStorage.longitude);
		}
	  } else {
		alert("Cannot store location");
		// return to homepage
	  }
	  
	  function submitLocation() {
		localStorage.latitude = latitude;
		localStorage.longitude = longitude;
	  }
	  
      // The following example creates a marker in Stockholm, Sweden using a DROP
      // animation. Clicking on the marker will toggle the animation between a BOUNCE
      // animation and no animation.
      let marker;

      function initMap() {
        const map = new google.maps.Map(document.getElementById("map"), {
          zoom: 13,
          center: { lat: 42.280, lng: -83.750 },
        });
        marker = new google.maps.Marker({
          map,
          draggable: true,
          animation: google.maps.Animation.DROP,
          position: { lat: latitude, lng: longitude },
        });
        marker.addListener("drag", toggleBounce);
		marker.addListener("dragend", toggleBounce);
      }

      function toggleBounce() {
        if (marker.getAnimation() !== null) {
          marker.setAnimation(null);
        } else {
          marker.setAnimation(google.maps.Animation.BOUNCE);
        }
		
		latitude = parseFloat(marker.getPosition().lat());
		longitude = parseFloat(marker.getPosition().lng());
		console.log(latitude);
		console.log(longitude);
      }
    </script>
  </head>
  <body>
    <h3>Drag pin to your location</h3>
    <div id="map"></div>
	<form name="form">
		<input 
			type="submit" 
			value="Save my location" 
			onClick="return submitLocation();"
		/>
	</form>
  </body>
</html>