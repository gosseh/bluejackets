<!DOCTYPE html>
<html>
  <head>
    <title>Marker Animations</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>
    <script
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCTujvwHxlUQq3MoQlAZJ1ps76sQSdCtI0&callback=initMap&libraries=&v=weekly"
      defer
    ></script>
    <style type="text/css">
      /* Set the size of the div element that contains the map */
      #map {
        height: 400px;
        /* The height is 400 pixels */
        width: 100%;
        /* The width is the width of the web page */
      }
    </style>
    <script>
	  let latitude = 42.280;
	  let longitude = -83.750;
	  if (typeof(Storage) !== "undefined") {
		if (localStorage.latitude && localStorage.longitude) {
	      latitude = parseFloat(localStorage.latitude);
		  longitude = parseFloat(localStorage.longitude);
		}
	  } else {
		alert("Cannot store location");
		// return to homepage
	  }
	  
	  function submitLocation() {
		localStorage.latitude = latitude;
		localStorage.longitude = longitude;
	  }
	  
      // The following example creates a marker in Stockholm, Sweden using a DROP
      // animation. Clicking on the marker will toggle the animation between a BOUNCE
      // animation and no animation.
      let marker;

      function initMap() {
        const map = new google.maps.Map(document.getElementById("map"), {
          zoom: 13,
          center: { lat: 42.280, lng: -83.750 },
        });
        marker = new google.maps.Marker({
          map,
          draggable: true,
          animation: google.maps.Animation.DROP,
          position: { lat: latitude, lng: longitude },
        });
        marker.addListener("drag", toggleBounce);
		marker.addListener("dragend", toggleBounce);
      }

      function toggleBounce() {
        if (marker.getAnimation() !== null) {
          marker.setAnimation(null);
        } else {
          marker.setAnimation(google.maps.Animation.BOUNCE);
        }
		
		latitude = parseFloat(marker.getPosition().lat());
		longitude = parseFloat(marker.getPosition().lng());
		console.log(latitude);
		console.log(longitude);
      }
    </script>
  </head>
  <body>
    <div class="navbar">
      <div class="header-title"> Bluejackets</div>
      <div class="header-description"> Find teammates for physical activities </div>
      <button id="filter"> 
          Filter 
          <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-chevron-compact-down" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
              <path fill-rule="evenodd" d="M1.553 6.776a.5.5 0 0 1 .67-.223L8 9.44l5.776-2.888a.5.5 0 1 1 .448.894l-6 3a.5.5 0 0 1-.448 0l-6-3a.5.5 0 0 1-.223-.67z"/>
            </svg>
      </button>
      <div id="weather"> Weather </div>
      <img src="images/cold.png" alt="weather-icon" id="weather-icon">
    </div>
    <div class="content-container">
      <h3>Drag pin to your location</h3>
      <div id="map"></div>
	    <form name="form">
		  <input 
			type="submit" 
			value="Save my location" 
			onClick="return submitLocation();"
		/>
	  </form>
    </div>
  </body>
</html>